{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DaleCrowder/photo-notes/app/new/page.tsx"],"sourcesContent":["'use client'\r\nimport { useState } from 'react'\r\nimport { supabaseBrowser } from '@/lib/supabaseClient'\r\n\r\nexport default function NewSubmission() {\r\n  const [file, setFile] = useState<File | null>(null)\r\n  const [desc, setDesc] = useState('')\r\n  const [loading, setLoading] = useState(false)\r\n  const supabase = supabaseBrowser()\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n    if (!file || !desc.trim()) return\r\n    setLoading(true)\r\n\r\n    // Ensure user\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    if (!user) { location.href = '/(auth)/login'; return }\r\n\r\n    // 1) Upload to storage\r\n    const ext = file.name.split('.').pop() || 'jpg'\r\n    const path = `${user.id}/${crypto.randomUUID()}.${ext}`\r\n    const { error: upErr } = await supabase.storage.from('photos').upload(path, file, {\r\n      cacheControl: '3600', upsert: false\r\n    })\r\n    if (upErr) { alert(upErr.message); setLoading(false); return }\r\n\r\n    // 2) Insert DB row\r\n    const { error: dbErr } = await supabase.from('submissions').insert({\r\n      user_id: user.id,\r\n      image_path: path,\r\n      description: desc.trim()\r\n    })\r\n    if (dbErr) { alert(dbErr.message); setLoading(false); return }\r\n\r\n    setDesc('')\r\n    setFile(null)\r\n    alert('Saved!')\r\n    location.href = '/my'\r\n  }\r\n\r\n  return (\r\n    <main className=\"p-6\">\r\n      <h1 className=\"text-xl font-bold mb-4\">New Submission</h1>\r\n      <form onSubmit={handleSubmit} className=\"flex flex-col gap-4\">\r\n        <input\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          capture=\"environment\"\r\n          onChange={(e) => setFile(e.target.files?.[0] ?? null)}\r\n        />\r\n        <textarea\r\n          className=\"border rounded-xl p-3 min-h-24\"\r\n          placeholder=\"Write a few sentences about the photo…\"\r\n          value={desc}\r\n          onChange={(e) => setDesc(e.target.value)}\r\n          maxLength={2000}\r\n        />\r\n        <button disabled={loading} className=\"border rounded-xl px-4 py-2\">\r\n          {loading ? 'Uploading…' : 'Save'}\r\n        </button>\r\n      </form>\r\n    </main>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;AAFA;;;AAIe,SAAS;;IACtB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAc;IAC9C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,WAAW,IAAA,2IAAe;IAEhC,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,IAAI;QAC3B,WAAW;QAEX,cAAc;QACd,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QACtD,IAAI,CAAC,MAAM;YAAE,SAAS,IAAI,GAAG;YAAiB;QAAO;QAErD,uBAAuB;QACvB,MAAM,MAAM,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM;QAC1C,MAAM,OAAO,AAAC,GAAa,OAAX,KAAK,EAAE,EAAC,KAA0B,OAAvB,OAAO,UAAU,IAAG,KAAO,OAAJ;QAClD,MAAM,EAAE,OAAO,KAAK,EAAE,GAAG,MAAM,SAAS,OAAO,CAAC,IAAI,CAAC,UAAU,MAAM,CAAC,MAAM,MAAM;YAChF,cAAc;YAAQ,QAAQ;QAChC;QACA,IAAI,OAAO;YAAE,MAAM,MAAM,OAAO;YAAG,WAAW;YAAQ;QAAO;QAE7D,mBAAmB;QACnB,MAAM,EAAE,OAAO,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,eAAe,MAAM,CAAC;YACjE,SAAS,KAAK,EAAE;YAChB,YAAY;YACZ,aAAa,KAAK,IAAI;QACxB;QACA,IAAI,OAAO;YAAE,MAAM,MAAM,OAAO;YAAG,WAAW;YAAQ;QAAO;QAE7D,QAAQ;QACR,QAAQ;QACR,MAAM;QACN,SAAS,IAAI,GAAG;IAClB;IAEA,qBACE,6LAAC;QAAK,WAAU;;0BACd,6LAAC;gBAAG,WAAU;0BAAyB;;;;;;0BACvC,6LAAC;gBAAK,UAAU;gBAAc,WAAU;;kCACtC,6LAAC;wBACC,MAAK;wBACL,QAAO;wBACP,SAAQ;wBACR,UAAU,CAAC;gCAAc;gCAAA;mCAAR,QAAQ,CAAA,oBAAA,kBAAA,EAAE,MAAM,CAAC,KAAK,cAAd,sCAAA,eAAgB,CAAC,EAAE,cAAnB,8BAAA,mBAAuB;;;;;;;kCAElD,6LAAC;wBACC,WAAU;wBACV,aAAY;wBACZ,OAAO;wBACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;wBACvC,WAAW;;;;;;kCAEb,6LAAC;wBAAO,UAAU;wBAAS,WAAU;kCAClC,UAAU,eAAe;;;;;;;;;;;;;;;;;;AAKpC;GA5DwB;KAAA","debugId":null}}]
}