{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DaleCrowder/photo-notes/app/api/submissions/%5Bid%5D/route.ts"],"sourcesContent":["// app/api/submissions/[id]/route.ts\r\nimport { NextResponse } from 'next/server'\r\nimport { cookies } from 'next/headers'\r\nimport { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs'\r\n\r\nexport const runtime = 'nodejs'\r\n\r\n// Next 15 async dynamic APIs: params must be awaited\r\ntype Ctx = { params: Promise<{ id: string }> }\r\n\r\nexport async function PATCH(req: Request, ctx: Ctx) {\r\n  const { id } = await ctx.params\r\n\r\n  const cookieStore = await cookies()\r\n  const supabase = createRouteHandlerClient({\r\n    // @ts-expect-error Next 15 cookies typing mismatch\r\n    cookies: () => cookieStore,\r\n  })\r\n\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return NextResponse.json({ error: 'Not authenticated' }, { status: 401 })\r\n\r\n  let body: any = null\r\n  try { body = await req.json() } catch {}\r\n  const description: string = (body?.description ?? '').toString().trim()\r\n  if (!description) return NextResponse.json({ error: 'Description is required' }, { status: 400 })\r\n  if (description.length > 2000) return NextResponse.json({ error: 'Max 2000 characters' }, { status: 400 })\r\n\r\n  const { data, error } = await supabase\r\n    .from('submissions')\r\n    .update({ description })\r\n    .eq('id', id)\r\n    .eq('user_id', user.id)\r\n    .select('id')\r\n    .single()\r\n\r\n  if (error) return NextResponse.json({ error: error.message }, { status: 400 })\r\n  if (!data) return NextResponse.json({ error: 'Not found' }, { status: 404 })\r\n  return NextResponse.json({ ok: true })\r\n}\r\n\r\nexport async function DELETE(req: Request, ctx: Ctx) {\r\n  const { id } = await ctx.params\r\n\r\n  const cookieStore = await cookies()\r\n  const supabase = createRouteHandlerClient({\r\n    // @ts-expect-error Next 15 cookies typing mismatch\r\n    cookies: () => cookieStore,\r\n  })\r\n\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return NextResponse.json({ error: 'Not authenticated' }, { status: 401 })\r\n\r\n  // 1) Fetch row (to get image_path and confirm ownership)\r\n  const { data: row, error: fetchErr } = await supabase\r\n    .from('submissions')\r\n    .select('id, user_id, image_path')\r\n    .eq('id', id)\r\n    .eq('user_id', user.id)\r\n    .single()\r\n\r\n  if (fetchErr) return NextResponse.json({ error: fetchErr.message }, { status: 400 })\r\n  if (!row) return NextResponse.json({ error: 'Not found' }, { status: 404 })}\r\n"],"names":[],"mappings":"AAAA,oCAAoC;;;;;;;;;AACpC;AACA;AACA;;;;AAEO,MAAM,UAAU;AAKhB,eAAe,MAAM,GAAY,EAAE,GAAQ;IAChD,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAI,MAAM;IAE/B,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,WAAW,IAAA,sMAAwB,EAAC;QACxC,mDAAmD;QACnD,SAAS,IAAM;IACjB;IAEA,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAoB,GAAG;QAAE,QAAQ;IAAI;IAElF,IAAI,OAAY;IAChB,IAAI;QAAE,OAAO,MAAM,IAAI,IAAI;IAAG,EAAE,OAAM,CAAC;IACvC,MAAM,cAAsB,CAAC,MAAM,eAAe,EAAE,EAAE,QAAQ,GAAG,IAAI;IACrE,IAAI,CAAC,aAAa,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAA0B,GAAG;QAAE,QAAQ;IAAI;IAC/F,IAAI,YAAY,MAAM,GAAG,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAsB,GAAG;QAAE,QAAQ;IAAI;IAExG,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,eACL,MAAM,CAAC;QAAE;IAAY,GACrB,EAAE,CAAC,MAAM,IACT,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM,CAAC,MACP,MAAM;IAET,IAAI,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO,MAAM,OAAO;IAAC,GAAG;QAAE,QAAQ;IAAI;IAC5E,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAY,GAAG;QAAE,QAAQ;IAAI;IAC1E,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;IAAK;AACtC;AAEO,eAAe,OAAO,GAAY,EAAE,GAAQ;IACjD,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAI,MAAM;IAE/B,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,WAAW,IAAA,sMAAwB,EAAC;QACxC,mDAAmD;QACnD,SAAS,IAAM;IACjB;IAEA,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAoB,GAAG;QAAE,QAAQ;IAAI;IAElF,yDAAyD;IACzD,MAAM,EAAE,MAAM,GAAG,EAAE,OAAO,QAAQ,EAAE,GAAG,MAAM,SAC1C,IAAI,CAAC,eACL,MAAM,CAAC,2BACP,EAAE,CAAC,MAAM,IACT,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;IAET,IAAI,UAAU,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO,SAAS,OAAO;IAAC,GAAG;QAAE,QAAQ;IAAI;IAClF,IAAI,CAAC,KAAK,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAY,GAAG;QAAE,QAAQ;IAAI;AAAE","debugId":null}}]
}